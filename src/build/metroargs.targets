<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <ConfigFile>.metroargs.json</ConfigFile>
  </PropertyGroup>
  <Target Name="CleanMetroArgs" BeforeTargets="_PackageExtraFilesMetroArgs" >
    <Delete Files="$(ConfigFile)" />
  </Target>

  <Target Name="_PackageExtraFilesMetroArgs" BeforeTargets="BuildMetroArgs">
    <Message Text="MetroArgs-PreCompilation-Files: %(PackagingOutputs.Identity)  TargetPath:%(PackagingOutputs.TargetPath)"  Importance="high" />
    <ItemGroup>
      <_AddToPackageFiles Include="$(ConfigFile)"></_AddToPackageFiles>
      <PackagingOutputs Include="@(_AddToPackageFiles -> '%(FullPath)')">
        <OutputGroup>Content</OutputGroup>
        <ProjectName>$(ProjectName)</ProjectName>
        <TargetPath>$(ConfigFile)</TargetPath>
      </PackagingOutputs>
    </ItemGroup>
  </Target>

  <Target Name="BuildMetroArgs" AfterTargets="BeforeBuild">
    <Message Text="MetroArgs-PostCompilation-Files: %(PackagingOutputs.Identity)  TargetPath:%(PackagingOutputs.TargetPath)"  Importance="high" />

    <WriteLinesToFile  File="$(ConfigFile)" Lines="{" Overwrite="true" Encoding="utf-8" />
    <WriteLinesToFile  File="$(ConfigFile)" Lines="&quot;Configuration&quot;:&quot;$(Configuration)&quot;" Overwrite="false" Encoding="utf-8" /> 
    <WriteLinesToFile  File="$(ConfigFile)" Lines="}" Overwrite="false" Encoding="utf-8" /> 
  </Target>
</Project>